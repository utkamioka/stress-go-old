# stress-go

`stress-go` は CPU・メモリ・ストレージに負荷をかけるためのシステム負荷テストツールです。

## 特徴

- **CPU負荷**: 指定したコア数でCPU使用率100%を実現
- **メモリ負荷**: 絶対値またはパーセンテージでメモリ使用量を制御
- **ストレージ負荷**: 絶対値またはパーセンテージでディスクI/O負荷を生成
- **クロスプラットフォーム**: Linux・Windows対応
- **安全な停止**: Ctrl+C (SIGINT) での安全な停止処理
- **進捗表示**: リアルタイムでの負荷状況表示

## インストール

### ビルド方法

```bash
# 現在のプラットフォーム用にビルド
make build

# Linux用にクロスコンパイル
make build-linux

# Windows用にクロスコンパイル  
make build-windows

# 全プラットフォーム用にビルド
make build-all
```

### システムにインストール

```bash
# /usr/local/bin にインストール (Linux/macOS)
make install
```

## 使用方法

### 基本構文

```bash
stress-go --timeout <時間> [オプション]
```

### オプション

- `--timeout <時間>`: 負荷をかける時間 (例: 30s, 5m, 1h) **[必須]**
- `--cpu <コア数>`: 使用するCPUコア数
- `--memory <サイズ>`: メモリ負荷 (例: 1GB, 512MB, 95%)
- `--storage <サイズ>`: ストレージ負荷 (例: 500MB, 80%)
- `--help`: ヘルプを表示

### 使用例

#### CPU負荷テスト
```bash
# 2コアに60秒間CPU負荷をかける
stress-go --timeout 60s --cpu 2

# 1コア機器で100%CPU使用率を実現
stress-go --timeout 30s --cpu 1
```

#### メモリ負荷テスト
```bash
# 1GBのメモリを5分間確保
stress-go --timeout 5m --memory 1GB

# 空きメモリの95%を2分間使用
stress-go --timeout 2m --memory 95%

# 512MBのメモリを30秒間確保
stress-go --timeout 30s --memory 512MB
```

#### ストレージ負荷テスト
```bash
# 500MBのファイルI/Oを3分間実行
stress-go --timeout 3m --storage 500MB

# 空きディスク容量の80%を2分間使用
stress-go --timeout 2m --storage 80%
```

#### 複合負荷テスト
```bash
# CPU + メモリ + ストレージの複合負荷
stress-go --timeout 30s --cpu 2 --memory 1GB --storage 500MB

# パーセンテージ指定での複合負荷
stress-go --timeout 60s --cpu 4 --memory 90% --storage 75%
```

## サイズ指定形式

### 絶対値指定
- `B`: バイト
- `KB`: キロバイト (1,024 B)
- `MB`: メガバイト (1,024 KB)
- `GB`: ギガバイト (1,024 MB)
- `TB`: テラバイト (1,024 GB)

大文字小文字は区別されません (`1gb` = `1GB`)。

### パーセンテージ指定
- メモリ: `95%` = 空きメモリの95%を使用
- ストレージ: `80%` = 空きディスク容量の80%を使用

## 動作について

### CPU負荷
- 指定されたコア数分のgoroutineで数学的計算を実行
- `runtime.GOMAXPROCS()` でOSスレッド数を制御
- 1コア機器で `--cpu 1` を指定するとタスクマネージャーでCPU使用率100%になります

### メモリ負荷
- 指定されたサイズのメモリを確保し、実際にデータを書き込み
- GCを無効化してメモリを確実に保持
- 定期的にメモリ使用状況を表示

### ストレージ負荷
- 一時ディレクトリに複数のファイルを作成
- ランダムデータの継続的な書き込み・読み取りでI/O負荷を生成
- 終了時に一時ファイルを自動クリーンアップ

## 安全機能

- **Ctrl+C対応**: SIGINT/SIGTERMでの安全な停止
- **自動クリーンアップ**: 一時ファイルとメモリの適切な解放
- **容量チェック**: パーセンテージ指定時の安全マージン適用
- **エラーハンドリング**: 詳細なエラーメッセージと適切な終了処理

## 開発

### テスト実行
```bash
make test
```

### コードフォーマット
```bash
make fmt
```

### 依存関係整理
```bash
make tidy
```

### クリーンアップ
```bash
make clean
```

## 注意事項

- 高負荷テストを実行する際は、システムの安定性に注意してください
- パーセンテージ指定時は、計算されたサイズの安全マージン（90-95%）が適用されます
- ストレージ負荷テストでは一時ファイルが作成されるため、十分な空き容量を確保してください
- 長時間の負荷テストを実行する場合は、システムの冷却や電力供給に注意してください

## ライセンス

このプロジェクトはSerpentineプロジェクトの一部として開発されています。# stress-go-old
